<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loan Application Form</title>
</head>
<body>
  <h1>Loan Application</h1>

  <form id="loanForm" enctype="multipart/form-data">
    <h2>Client Internal</h2>
    <input type="text" name="nama_lengkap" placeholder="Nama Lengkap" required><br>
    <input type="text" name="no_ktp" placeholder="No KTP" required><br>
    <input type="text" name="no_hp" placeholder="No HP" required><br>
    <input type="email" name="email" placeholder="Email" required><br>
    Foto KTP: <input type="file" name="foto_ktp"><br>
    Foto KK: <input type="file" name="foto_kk"><br>
    Foto ID Card: <input type="file" name="foto_id_card"><br>
    Foto Rekening: <input type="file" name="foto_rekening"><br>

    <h2>Address Internal</h2>
    <input type="text" name="alamat_ktp" placeholder="Alamat KTP"><br>
    <input type="text" name="rt_rw" placeholder="RT/RW"><br>
    <input type="text" name="kelurahan" placeholder="Kelurahan"><br>
    <input type="text" name="kecamatan" placeholder="Kecamatan"><br>
    <input type="text" name="kota" placeholder="Kota"><br>
    <input type="text" name="provinsi" placeholder="Provinsi"><br>

    <h2>Family Internal</h2>
    <input type="text" name="hubungan" placeholder="Hubungan"><br>
    <input type="text" name="nama_keluarga" placeholder="Nama"><br>
    <input type="text" name="bekerja" placeholder="Pekerjaan"><br>
    <input type="text" name="no_hp_keluarga" placeholder="No HP"><br>

    <h2>Job Internal</h2>
    <input type="text" name="perusahaan" placeholder="Perusahaan"><br>
    <input type="text" name="divisi" placeholder="Divisi"><br>
    <input type="number" name="lama_kerja_tahun" placeholder="Lama Kerja (Tahun)"><br>
    <input type="number" name="lama_kerja_bulan" placeholder="Lama Kerja (Bulan)"><br>
    <input type="text" name="golongan" placeholder="Golongan"><br>
    <input type="text" name="nama_atasan" placeholder="Nama Atasan"><br>
    <input type="text" name="nama_hrd" placeholder="Nama HRD"><br>
    <input type="text" name="absensi" placeholder="Absensi"><br>

    <h2>Loan Application Internal</h2>
    <input type="text" name="status_pinjaman" placeholder="Status Pinjaman"><br>
    <input type="number" name="nominal_pinjaman" placeholder="Nominal Pinjaman"><br>
    <input type="number" name="tenor" placeholder="Tenor (bulan)"><br>
    <input type="text" name="keperluan" placeholder="Keperluan"><br>
    <input type="text" name="notes" placeholder="Notes"><br>

    <h2>Collateral Internal</h2>
    <input type="text" name="jaminan_hrd" placeholder="Jaminan HRD"><br>
    <input type="text" name="jaminan_cg" placeholder="Jaminan CG"><br>
    <input type="text" name="penjamin" placeholder="Penjamin"><br>

    <h2>Relative Internal</h2>
    <input type="text" name="kerabat_kerja" placeholder="Kerabat Kerja"><br>
    <input type="text" name="nama_kerabat" placeholder="Nama"><br>
    <input type="text" name="alamat_kerabat" placeholder="Alamat"><br>
    <input type="text" name="no_hp_kerabat" placeholder="No HP"><br>

    <br>
    <button type="submit">Submit</button>
  </form>

  <pre id="responseBox"></pre>

  <script>
    document.getElementById("loanForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(e.target);

      // Build payload JSON
      const payload = {
        client_internal: {
          nama_lengkap: formData.get("nama_lengkap"),
          no_ktp: formData.get("no_ktp"),
          no_hp: formData.get("no_hp"),
          email: formData.get("email")
        },
        address_internal: {
          alamat_ktp: formData.get("alamat_ktp"),
          rt_rw: formData.get("rt_rw"),
          kelurahan: formData.get("kelurahan"),
          kecamatan: formData.get("kecamatan"),
          kota: formData.get("kota"),
          provinsi: formData.get("provinsi")
        },
        family_internal: {
          hubungan: formData.get("hubungan"),
          nama: formData.get("nama_keluarga"),
          bekerja: formData.get("bekerja"),
          no_hp: formData.get("no_hp_keluarga")
        },
        job_internal: {
          perusahaan: formData.get("perusahaan"),
          divisi: formData.get("divisi"),
          lama_kerja_tahun: parseInt(formData.get("lama_kerja_tahun")) || 0,
          lama_kerja_bulan: parseInt(formData.get("lama_kerja_bulan")) || 0,
          golongan: formData.get("golongan"),
          nama_atasan: formData.get("nama_atasan"),
          nama_hrd: formData.get("nama_hrd"),
          absensi: formData.get("absensi")
        },
        loan_application_internal: {
          status_pinjaman: formData.get("status_pinjaman"),
          nominal_pinjaman: parseInt(formData.get("nominal_pinjaman")) || 0,
          tenor: parseInt(formData.get("tenor")) || 0,
          keperluan: formData.get("keperluan"),
          notes: formData.get("notes")
        },
        collateral_internal: {
          jaminan_hrd: formData.get("jaminan_hrd"),
          jaminan_cg: formData.get("jaminan_cg"),
          penjamin: formData.get("penjamin")
        },
        relative_internal: {
          kerabat_kerja: formData.get("kerabat_kerja"),
          nama: formData.get("nama_kerabat"),
          alamat: formData.get("alamat_kerabat"),
          no_hp: formData.get("no_hp_kerabat")
        }
      };

      // Kirim payload JSON + file
      const finalFormData = new FormData();
      finalFormData.append("payload", JSON.stringify(payload));

      // append files
      ["foto_ktp", "foto_kk", "foto_id_card", "foto_rekening"].forEach((key) => {
        const fileInput = document.querySelector(`input[name="${key}"]`);
        if (fileInput && fileInput.files[0]) {
          finalFormData.append(key, fileInput.files[0]);
        }
      });

      try {
        const res = await fetch("http://localhost:3001/mkt/int/drafts/add", {
          method: "POST",
          body: finalFormData
        });
        const data = await res.json();
        document.getElementById("responseBox").textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById("responseBox").textContent = "Error: " + err.message;
      }
    });
  </script>
</body>
</html>
